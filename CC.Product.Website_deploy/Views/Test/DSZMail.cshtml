@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>董事长信箱</title>
    <link href="~/Content/bootstrap.css" rel="stylesheet" />
    <link href="~/Content/EasyUI/themes/gray/easyui.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/EasyUI/themes/icon.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/EasyUI/themes/color.css" rel="stylesheet" type="text/css" />
    <script src="~/Content/EasyUI/jquery.min.js" type="text/javascript"></script>
    <script src="~/Content/EasyUI/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="~/Content/EasyUI/easyui-lang-zh_CN.js" type="text/javascript"></script>
</head>
<body style="padding-top:50px">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <table id="dg" title="董事长信箱" class="easyui-datagrid" style="width: 100%; height: 550px"
                       url="/Test/GetDSZMails" striped="true" toolbar="#toolbar" pagination="true"
                       rownumbers="true" fitcolumns="true" singleselect="true" data-options="onLoadSuccess:onLoadSuccess">
                    <thead>
                        <tr>
                            <th field="Subject" width="50">
                                主题
                            </th>
                            <th field="UserName" width="50">
                                发送用户
                            </th>
                            <th field="SendDate" width="50">
                                发送日期
                            </th>
                            <th field="State" width="50">
                                状态
                            </th>
                            @*<th field="ReplyDate" width="50">
                                批复时间
                            </th>*@
                            <th field="Content" width="50">
                                内容
                            </th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div id="toolbar">
                @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="newOpinion()">新增</a>*@
                <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" plain="true" onclick="viewOpinion()">查看</a>
                @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit" plain="true" onclick="editOpinion()">修改</a>*@
                @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-redo" plain="true" onclick="ReplyOpinion()">发送</a>*@
                @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-undo" plain="true" onclick="ReplyOpinion()">回复</a>*@
                @*<a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="destroyOpinion()">删除</a>*@
            </div>
        </div>
        <div id="dlg" class="easyui-dialog" style="width: 500px; height: 400px; padding: 10px 20px"
             closed="true" buttons="#dlg-buttons">
            <div class="ftitle">
                编辑 
            </div>
            <form id="fm" method="post" action="" novalidate>
                <div class="fitem">
                    <label>
                        主题:
                    </label>
                    <input name="Subject" class="easyui-textbox" required="true" style="width: 250px" />
                </div>
                <div class="fitem">
                    <label>
                        内容:
                    </label>
                    <input name="Content" class="easyui-textbox" data-options="multiline:true" required="true"
                           style="height: 200px; width: 250px" />
                </div>
                @*<div class="fitem">
                    <label>
                        用户:
                    </label>
                    <input name="UserName" class="easyui-textbox" required="true" disabled="true"
                           style="width: 250px" />
                </div>*@

            </form>
        </div>

        <div id="dlg-buttons">
            <a href="javascript:void(0)" class="easyui-linkbutton c6" iconcls="icon-ok" onclick="saveUser()" style="width: 90px">保存</a>
            <a href="javascript:void(0)" class="easyui-linkbutton c6" iconcls="icon-redo" onclick="saveUser()" style="width: 90px">保存并发送</a>
             <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')" style="width: 90px">取消</a>
        </div>

        <div id="view" class="easyui-dialog" style="width: 500px; height: 600px; padding: 10px 20px"
             closed="true" buttons="#dlg-buttons1">
            <div class="ftitle">
                查看
            </div>
            <form id="formView" method="post" action="" novalidate>
                <div class="fitem">
                    <label>
                        主题:
                    </label>
                    <input name="Subject" class="easyui-textbox" required="true" disabled="true" style="width: 250px" />
                </div>
                <div class="fitem">
                    <label>
                        用户:
                    </label>
                    <input name="UserName" class="easyui-textbox" required="true" disabled="true"
                           style="width: 250px" />
                </div>
                <div class="fitem">
                    <label>
                        日期:
                    </label>
                    <input name="SendDate" class="easyui-textbox" required="true" disabled="true"
                           style="width: 250px" />
                </div>
                <div class="fitem">
                    <label>
                        状态:
                    </label>
                    <input name="State" class="easyui-textbox" required="true" disabled="true"
                           style=" width: 250px" />
                </div>
                <div class="fitem">
                    <label>
                        内容:
                    </label>
                    <input name="Content" class="easyui-textbox" data-options="multiline:true" required="true" disabled="true"
                           style="height: 150px; width: 250px" />
                </div>
                <div class="fitem">
                    <label>
                        批复日期:
                    </label>
                    <input name="ReplyDate" class="easyui-textbox" required="true" disabled="true"
                           style="width: 250px" />
                </div>
                <div class="fitem">
                    <label>
                        批复内容:
                    </label>
                    <input name="ReplyContent" class="easyui-textbox" data-options="multiline:true" required="true"
                           style="height: 150px;width: 250px" />
                </div>

            </form>
        </div>

        <div id="dlg-buttons1">
            <a href="javascript:void(0)" class="easyui-linkbutton"
               iconcls="icon-ok" onclick="javascript:$('#dlg').dialog('close')" style="width: 90px">
                回复
            </a>
            <a href="javascript:void(0)" class="easyui-linkbutton"
               iconcls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')" style="width: 90px">
                取消
            </a>
        </div>


        <script type="text/javascript">
            $(function () {
                $('#dg').datagrid({
                    onClickRow: function (rowIndex, rowData) {
                        var row = $('#dg').datagrid('getSelected');
                        $('#Table1').datagrid('load', {
                            code: row.Code
                        });
                    }

                });
            });

            function onLoadSuccess() {
                $('#dg').datagrid('selectRow', 0)
            }

            function onRowClick() {
                var row = $('#dg').datagrid('getSelected');
                $('#Table1').datagrid('load', {
                    id: row.id,
                    code: '01',
                    name: 'name01'
                });
            }


            var url;

            function viewOpinion() {
                var row = $('#dg').datagrid('getSelected');
                if (row) {
                    $('#view').dialog('open').dialog('setTitle', '查看意见');
                    $('#formView').form('load', row);

                    url = 'update_user.php?id=' + row.id;
                }
            }

            function newOpinion() {
                $('#dlg').dialog('open').dialog('setTitle', '新增');
                $('#fm').form('clear');
                url = 'save_user.php';
            }
            function editOpinion() {
                var row = $('#dg').datagrid('getSelected');
                if (row) {
                    $('#dlg').dialog('open').dialog('setTitle', '编辑意见');
                    $('#fm').form('load', row);

                    url = 'update_user.php?id=' + row.id;
                }
            }

            function ReplyOpinion() {
                var row = $('#dg').datagrid('getSelected');
                if (row) {
                    $('#dlg').dialog('open').dialog('setTitle', '答复意见');
                    $('#fm').form('load', row);

                    url = 'update_user.php?id=' + row.id;
                }
            }


            function saveOpinion() {
                $('#fm').form('submit', {
                    url: url,
                    onSubmit: function () {
                        return $(this).form('validate');
                    },
                    success: function (result) {
                        var result = eval('(' + result + ')');
                        if (result.errorMsg) {
                            $.messager.show({
                                title: 'Error',
                                msg: result.errorMsg
                            });
                        } else {
                            $('#dlg').dialog('close');        // close the dialog
                            $('#dg').datagrid('reload');    // reload the user data
                        }
                    }
                });
            }
            function destroyOpinion() {
                var row = $('#dg').datagrid('getSelected');
                if (row) {
                    $.messager.confirm('Confirm', 'Are you sure you want to destroy this user?', function (r) {
                        if (r) {
                            $.post('destroy_user.php', { id: row.id }, function (result) {
                                if (result.success) {
                                    $('#dg').datagrid('reload');    // reload the user data
                                } else {
                                    $.messager.show({    // show error message
                                        title: 'Error',
                                        msg: result.errorMsg
                                    });
                                }
                            }, 'json');
                        }
                    });
                }
            }
        </script>

        <style type="text/css">
            #fm {
                margin: 0;
                padding: 10px 30px;
            }

            .ftitle {
                font-size: 14px;
                font-weight: bold;
                padding: 5px 0;
                margin-bottom: 10px;
                border-bottom: 1px solid #ccc;
            }

            .fitem {
                margin-bottom: 5px;
            }

                .fitem label {
                    display: inline-block;
                    width: 80px;
                }

                .fitem input {
                    width: 160px;
                }
        </style>
    </div>


</body>
</html>
