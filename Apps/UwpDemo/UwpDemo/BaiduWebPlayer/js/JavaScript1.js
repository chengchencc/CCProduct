define("common:widget/activateGuide/activateGuide.js", function (t, i, e) { var a = t("common:widget/libs/jquerypacket.js"), n = t("common:widget/commonService/commonService.js"), o = {}; o.LoginActivate = 1, o.unLoginActivate = 2, o.main = function () { var t = this; this._insertStyle(), a(window).ready(function () { 1 == yunData.LOGINSTATUS ? a.get("/api/account/uinfo?t=" + (new Date).getTime(), function (i) { try { var e = a.parseJSON(i) || i } catch (n) { } 0 == e.type && t.warmupHTML(o.LoginActivate) }) : t.warmupHTML(o.unLoginActivate) }) }, o.insertStyle = function (t) { var i = document.createElement("style"); i.type = "text/css", document.getElementsByTagName("head")[0].appendChild(i), i.styleSheet ? i.styleSheet.cssText = t : i.appendChild(document.createTextNode(t)) }, o._insertStyle = function () { if (!this._styleInserted) { this._styleInserted = !0; var t = [], i = "", e = ""; if (i = "undefined" != typeof Page && (Page.inViewMode(Page.VIEW_PROPERTY_OTHER) || Page.inViewMode(Page.VIEW_HOME_PAGE_SLAVE)) ? "25px" : "5px", a.browser.msie && 6 == a.browser.version) { e = "absolute"; var n = 0; a(window).scroll(function () { clearTimeout(n), n = setTimeout(function () { "5px" == a(".activate-outer").css("bottom") && a(".activate-outer").css("bottom", "6px").css("bottom", "5px") }, 200) }) } else e = "fixed"; t.push(".activate-outer { display:none; background:#fcfaf2; width: 265px;bottom: -195px;z-index: 2999;padding: 10px;border: 1px solid #efebd8;border-radius: 3px;box-shadow: 0px 0px 15px black;}"), t.push(".activate-outer {right: " + i + "; position:" + e + "; }"), t.push(".activate-outer dl { margin-bottom: 10px;}"), t.push(".activate-h{ font-size: 14px; font-weight: bold;}"), t.push(".activate-cls-btn{ width: 20px; height: 20px; background: url(/res/static/images/btn_icon.gif) -106px -114px no-repeat;cursor: pointer;}"), t.push(".activate-noti{ padding: 20px;}"), t.push(".activate-noti-h-ico{ width: 25px;  height: 20px; background:url(/res/static/images/btn_icon.gif) 0px -576px no-repeat; _display:inline; margin: 0 7px 0 -3px;}"), t.push(".activate-btn,.activate-btn b{ position: relative; height: 37px;width: 130px;display: block;text-align: center;line-height: 37px;margin: 0 auto;font-size: 14px;color: white;background: url('/res/static/images/btn_sprit.gif') 0 -711px no-repeat;text-decoration: none;cursor: pointer;padding-left: 1px; font-weight: normal; }"), t.push(".activate-btn b{ background-position: right -711px; }"), t.push(".activate-btn:hover,.activate-btn:active{ color: white;text-decoration:none; }"), t.push(".activate-btn:hover{background-position:  0 -763px; }"), t.push(".activate-btn:hover b{ background-position: right -763px; }"), t.push(".activate-btn:active{background-position:  0 -817px; }"), t.push(".activate-btn:active b{ background-position: right -817px; }"), t.push(".activate-qq { width: 280px;}"), t.push(".activate-qq .activate-noti { padding: 30px 15px;}"), t.push(".activate-qq .activate-btn b{ }"), t.push(".activate-qq .activate-qq-ico { height: 27px;width: 24px;position: absolute;left: 10px;top: 5px;background: url('/res/static/images/btn_icon.gif') -29px -577px no-repeat;z-index: 1;}"), t.push(".active-disk { width: 300px; height: 200px; background:url(/res/static/images/active_pan_1024.png?t=201308291902) center no-repeat; border: none; padding: 0;}"), t.push(".active-disk .activate-disk-cls-btn { display:block; width:10px; height:10px; position:absolute; top:8px; right:10px; cursor:pointer; font-size: 0;}"), t.push(".active-disk .activate-disk-btn { display:block; width:175px; height:45px; position:absolute; top:145px; left:60px; cursor:pointer;font-size: 0;}"), this.insertStyle(t.join("")) } }, o.warmupHTML = function (t) { var i = []; switch (t) { case o.LoginActivate: i.push('<div id="activateGuidePopupOuter" class="activate-outer">'), i.push('<dl class="clearfix"><span class="activate-noti-h-ico b-fl"></span><h1 class="activate-h b-fl">百度云赠送空间</h1><span class="activate-cls-btn b-fr"></span></dl>'), i.push('<dl class="activate-noti clearfix"><!--span class="activate-noti-ico b-fl"></span-->发放福利啦！你已是百度用户，点击即可领取百度云网盘<span style="font-weight:bold;">2048G永久免费容量</span>。</dl>'), i.push('<dl><a hideFocus="true" target="_blank" href="http://pan.baidu.com/disk/home#from=share_activate_guide" class="activate-btn"><b>领取2048G容量</b></a></dl>'), i.push("</div>"); break; case o.unLoginActivate: i.push('<div id="activateGuidePopupOuter" class="activate-outer activate-qq">'), i.push('<dl class="clearfix"><span class="activate-noti-h-ico b-fl"></span><h1 class="activate-h b-fl">百度云赠送空间</h1><span class="activate-cls-btn b-fr"></span></dl>'), i.push('<dl class="activate-noti clearfix"><!--span class="activate-noti-ico b-fl"></span-->发福利啦！新用户可以获得百度云<span style="font-weight:bold;">2048G永久免费容量</span>，超大文件极速秒传！</dl>'), i.push('<dl><a hideFocus="true" class="activate-btn third-qq"><b>领取2048G容量</b></a></dl>'), i.push("</div>") } var e = i.join(""); a("body").append(e), this.toggleFn(t), this.toggleLog(t), this.visible(!0), o._buildIFrameMask() }, o._buildIFrameMask = function () { var t = document.createElement("iframe"); document.getElementById("activateGuidePopupOuter").appendChild(t), t.frameBorder = "0", t.src = "about:blank", t.style.position = "absolute", t.style.left = "0", t.style.top = "0", t.style.zIndex = "-1", t.style.width = "100%", t.style.height = "100%", a(t).css("opacity", "0") }, o.toggleFn = function (t) { var i = this; switch (a(".activate-cls-btn , .activate-btn").click(function () { i.visible(!1) }), t) { case o.unLoginActivate: o.thirdLogin() } }, o.thirdLogin = function () { if ("undefined" != typeof disk) { var t = -1; disk.globalThirdLoginSuccess = function () { -1 !== document.cookie.indexOf("BDU_THIRD") && (n.diskLog.send({ type: "share_qq_activate_guide_succ" }), n.sendUserReport("share_qq_activate_guide"), clearTimeout(t), setTimeout(function () { window.location.reload() }, 500)) } } a(".activate-outer a.third-qq").click(function () { window.location.href = "http://pan.baidu.com/?frm=sharelogin" }) }, o.toggleLog = function (t) { switch (t) { case o.unLoginActivate: a(".activate-cls-btn").click(function () { n.diskLog.send({ type: "unlogin_guide_activate_colse" }) }), a(".activate-btn").click(function () { n.diskLog.send({ type: "share_qq_activate_guide" }) }); break; case o.LoginActivate: a(".activate-cls-btn").click(function () { n.diskLog.send({ type: "login_guide_activate_colse" }) }), a(".activate-btn").click(function () { n.diskLog.send({ type: "login_guide_activate" }) }), a(".yun-logo").click(function () { n.diskLog.send({ type: "login_yun_logo_activate" }) }), a(".pan-logo").click(function () { n.diskLog.send({ type: "login_pan_logo_activate" }) }) } }, o.visible = function (t) { t ? a(".activate-outer").show().animate({ bottom: 5 }, 1e3) : a(".activate-outer").hide() }, o.main(), e.exports = o });
; define("common:widget/dispatchEvent/dispatchEvent.js", function (t, o, n) { n.exports = function (t, o) { return "function" == typeof this["on" + t] ? (disk.DEBUG && console.log("[LOG] call the delegate function `on" + t + "` of the obj:", this, " successful"), "[object Array]" === Object.prototype.toString.call(o) ? this["on" + t].apply(this, o) : this["on" + t].apply(this), this) : (disk.DEBUG && console.log("[WARN] the delegate function `on" + t + "` of the obj:", this, " is not a function"), !1) } });
; define("common:widget/loginDialog/loginDialog.js", function (i, t, e) { var n = i("common:widget/libs/jquerypacket.js"), o = i("common:widget/panel/panel.js"), l = i("common:widget/context/context.js"), a = i("common:widget/toastPanel/toastPanel.js"), s = function () { this._getEnoughScript = 0, this._mCloseId = disk.obtainId(), o.call(this, this._prebuild(this._mCloseId)), this._initUI() }; s.defaultSuccVal = 1, s.otherSuccVal = 2, s.loginReload = !1, s.singleton = null, s.obtain = function () { return s.singleton ? s.singleton : s.singleton = new s }, s.prototype = new o, s.prototype._prebuild = function (i) { var t = document.createElement("div"); t.className = "dialog-panel box-shadow4 bdr-rnd-3 login-dialog"; var e = ["<div class='dlg-hd b-rlv'>", "<span title='关闭' id='", i, "' class='dlg-cnr dlg-cnr-r'></span>", "<h3>登录</h3>", "</div>", "<div class='dlg-bd clearfix'>", "</div>"]; return t.innerHTML = e.join(""), document.body.appendChild(t), { pane: t } }, s.prototype._initUI = function () { var i = this; n(window).bind("resize", function () { i.setGravity(o.CENTER) }), n("#" + this._mCloseId + ", #" + this._mCancelId).click(function () { i.setVisible(!1) }) }, s.prototype.onResizeHeight = function (i) { n("#disk_login", this.pane).height(i) }, s.prototype.onLoginSuccess = function (i) { this.setVisible(!1); var t = this.onLoginSuccessCallback(i); "undefined" == typeof t || t === s.defaultSuccVal ? (a.obtain.useToast({ toastMode: a.obtain.MODE_SUCCESS, msg: "登录成功后将刷新页面", sticky: !1 }), setTimeout(function () { location.reload() }, 3e3)) : t === s.otherSuccVal && this._refreshTopMenu(i) }, s.prototype.onLoginSuccessCallback = function () { disk.DEBUG && console.log("Login Success!") }, s.prototype.onReady = function () { this._mUI.pane.style.display = "block", this.setGravity(o.CENTER), this.onReadyCallback(), this.setVisible(!0) }, s.prototype.onReadyCallback = function () { disk.DEBUG && console.log("Login Ready!") }, s.prototype.onCloseCallback = function () { disk.DEBUG && console.log("loginIframe Close!") }, s.prototype._refreshTopMenu = function (i) { this._removeUserLogin(), this._buildUserInfos(i) }, s.prototype._removeUserLogin = function () { var i = n(".top_menu"); if ("undefined" != typeof i[0]) { var t = i.children("li"), e = t.size(); e > 2 && (t.eq(--e).remove(), t.eq(--e).remove()) } }, s.prototype._buildUserInfos = function (i, t) { t = t || ""; var e = n(".top_menu"), o = '<li class="b-list-item list-li haspulldown" style="_width:76px;max-width:116px" title="' + i + '"><span class="top-username">' + i + '</span><em class="img-ico">&nbsp;</em><div style="display: none;" class="pull-down-menu"><ul><li><a href="http://passport.baidu.com/center" target="_blank">个人资料</a></li><li><a href="http://yun.baidu.com/buy/center?tag=1" target="_blank">购买容量</a></li><li><a href="/disk/award" target="_blank">免费扩容</a></li><li class="pull-menu-separator"><a href="http://wallet.baidu.com/" target="_blank">百度钱包</a></li><li><a href="javascript:void(0);" id="flag-2-signout">退出</a></li></ul></div></li><li class="b-list-item list-li"><a class="b-no-ln" href="/infocenter/download" target="_blank">客户端下载</a></li><li class="b-list-item  list-li notice"> <a class="b-no-ln" href="/disk/home#noti">通知</a> <em id="noticeNoParent" style="' + (!t && "display:none") + '"><b id="noticeNo">' + t + '</b></em></li><li class="b-list-item haspulldown moreinfo"><span>更多</span><em class="img-ico">&nbsp;</em><div style="display: none;" class="pull-down-menu"><ul><li class="pull-menu-separator"><a class="b-no-ln open-platform" href="http://pan.baidu.com/platform/home" target="_blank">移动开放平台</a></li><li><a href="/disk/history#history/tab=all">历史记录</a></li><li><a href="http://yun.baidu.com/disk/version" target="_blank">版本更新</a></li><li><a href="http://yun.baidu.com/disk/help" target="_blank">帮助中心</a></li><li class="pull-menu-separator"><a href="http://qingting.baidu.com/index?pid=19" target="_blank">问题反馈</a></li><li><a href="http://yun.baidu.com/disk/duty" target="_blank">服务协议</a></li><li><a href="http://yun.baidu.com/disk/privacy" target="_blank">权利声明</a></li></ul></div></li>'; e.append(o).find(".haspulldown").mouseenter(function () { n(this).find(".pull-down-menu").show() }).mouseleave(function () { n(this).find(".pull-down-menu").hide() }), e.find("#flag-2-signout").click(function (i) { var t = encodeURIComponent(location.href); window.location.href = "https://passport.baidu.com/?logout&u=" + t, i.preventDefault() }) }, s.prototype.onVisibilityChange = function (i) { l.getService(l.SERVICE_CANVAS).setVisible(i), i || this.onCloseCallback() }, s.prototype.setVisible = function (i) { var t = (this._mPrivateFlags & o.VISIBLE) == o.VISIBLE; i !== t && (i ? (this._mPrivateFlags |= o.VISIBLE, n(".dlg-bd", this._mUI.pane).html('<iframe id="disk_login" frameborder=\'0\' src="/res/static/thirdparty/passportLogin.html"></iframe>')) : (this._mPrivateFlags &= ~o.VISIBLE, clearInterval(n("#disk_login")[0].contentWindow.t), n.browser.msie && "6.0" == n.browser.version || n(".dlg-bd", this._mUI.pane).html(""), this._mUI.pane.style.display = "none"), this.onVisibilityChange(i)) }, e.exports = s });
; define("common:widget/shareCount/shareCount.js", function (r, o, e) { var t = r("common:widget/libs/jquerypacket.js"), a = { reqUrl: "/share/count", provideShareData: function (r) { return r.uk ? void a._fetchData(r.uk, r.shareId, r.type, r.callback) : void (disk.DEBUG && console.log("[shareCount.provideShareData()] uk is must")) }, _fetchData: function (r, o, e, n) { var i = {}; void 0 !== r && (i.uk = r), void 0 !== o && (i.shareid = o), void 0 !== e && (i.type = e), t.ajax({ url: a.reqUrl, type: "get", data: i, dataType: "json", success: function (r) { 0 === r.errno ? n(r) : a.doError(r.errno) }, error: function () { a.doError() } }) }, doError: function () { } }; e.exports = a });
; define("common:widget/shareOperateBtn/shareOperateBtn.js", function (e, t, n) { var a = e("common:widget/libs/jquerypacket.js"), i = e("common:widget/toast/toast.js"), s = e("common:widget/panel/panel.js"), o = (e("common:widget/context/context.js"), e("common:widget/restApi/restApi.js")), r = (e("common:widget/category/category.js"), e("common:widget/interactiveService/interactiveService.js")), l = e("common:widget/dispatchEvent/dispatchEvent.js"), c = e("common:widget/commonService/commonService.js"), d = e("common:widget/stroage/storage.js"), E = function (e) { this.pageBtnConf = e, this.shareFileName = e.info[0].server_filename, e.pageType === E.PAGETYPE_MULTI && (this.shareFileName += "等"), this.dispatchEvent = l, this._mAlbumMethod = void 0, this._mCommentPanel = void 0, this.isAlreadyGetLike = !1, this.selectedFileList = null, this.init() }; E.recommendStatus = !1, E.recommendNumber = 0, E.commentNumber = 0, E.isNewUserAndNoMobile = 0, E.isNotLoginStatus = !1, E.SHARETYPE_PUBLIC = "pubulic_share", E.SHARETYPE_PRIVACY = "privacy_share", E.SHARETYPE_ALBUM = "album_share", E.PAGETYPE_SINGLE = "single_file_page", E.PAGETYPE_MULTI = "multi_file", E.VIDEO_SAMPLING = "video_sampling", E.TYPE_CANCELSHARE = "cancel_share", E.TYPE_SAVETODISK = "save_to_disk", E.TYPE_SAVEANDPLAY = "save_and_play", E.TYPE_DOWNLOAD = "download", E.TYPE_DIMESIONAL = "dimensional_code", E.TYPE_RECOMMEND = "recommend", E.TYPE_REPORT = "inform", E.TYPE_COMMENT = "comment", E.TYPE_SHARETO = "share_to_thirdparty", E.TYPE_ALBUM_ADD = "album_add_file", E.TYPE_ALBUM_EDIT = "album_edit", E.TYPE_ALBUM_DELETE = "album_delete", E.SELF_BTN_CONF = {}, E.SELF_BTN_CONF[E.SHARETYPE_PUBLIC] = {}, E.SELF_BTN_CONF[E.SHARETYPE_PUBLIC][E.PAGETYPE_MULTI] = [E.TYPE_CANCELSHARE, E.TYPE_DOWNLOAD, E.TYPE_DIMESIONAL, E.TYPE_RECOMMEND, E.TYPE_COMMENT, E.TYPE_SHARETO], E.SELF_BTN_CONF[E.SHARETYPE_PUBLIC][E.PAGETYPE_SINGLE] = [E.TYPE_CANCELSHARE, E.TYPE_DOWNLOAD, E.TYPE_DIMESIONAL, E.TYPE_RECOMMEND, E.TYPE_COMMENT, E.TYPE_SHARETO], E.OTHERS_BTN_CONF = {}, E.OTHERS_BTN_CONF[E.SHARETYPE_PUBLIC] = {}, E.OTHERS_BTN_CONF[E.SHARETYPE_PUBLIC][E.PAGETYPE_MULTI] = [E.TYPE_SAVETODISK, E.TYPE_DOWNLOAD, E.TYPE_DIMESIONAL, E.TYPE_RECOMMEND, E.TYPE_COMMENT, E.TYPE_SHARETO, E.TYPE_REPORT], E.OTHERS_BTN_CONF[E.SHARETYPE_PUBLIC][E.PAGETYPE_SINGLE] = [E.TYPE_SAVETODISK, E.TYPE_DOWNLOAD, E.TYPE_DIMESIONAL, E.TYPE_RECOMMEND, E.TYPE_COMMENT, E.TYPE_SHARETO, E.TYPE_REPORT], E.OTHERS_BTN_CONF[E.VIDEO_SAMPLING] = {}, E.OTHERS_BTN_CONF[E.VIDEO_SAMPLING][E.PAGETYPE_SINGLE] = [E.TYPE_SAVEANDPLAY, E.TYPE_DOWNLOAD, E.TYPE_DIMESIONAL, E.TYPE_RECOMMEND, E.TYPE_COMMENT, E.TYPE_SHARETO, E.TYPE_REPORT], E.SELF_BTN_CONF[E.SHARETYPE_PRIVACY] = {}, E.SELF_BTN_CONF[E.SHARETYPE_PRIVACY][E.PAGETYPE_SINGLE] = [E.TYPE_CANCELSHARE, E.TYPE_DOWNLOAD, E.TYPE_DIMESIONAL, E.TYPE_SHARETO], E.SELF_BTN_CONF[E.SHARETYPE_PRIVACY][E.PAGETYPE_MULTI] = [E.TYPE_CANCELSHARE, E.TYPE_DOWNLOAD, E.TYPE_DIMESIONAL, E.TYPE_SHARETO], E.OTHERS_BTN_CONF[E.SHARETYPE_PRIVACY] = {}, E.OTHERS_BTN_CONF[E.SHARETYPE_PRIVACY][E.PAGETYPE_SINGLE] = [E.TYPE_SAVETODISK, E.TYPE_DOWNLOAD, E.TYPE_DIMESIONAL, E.TYPE_SHARETO, E.TYPE_REPORT], E.OTHERS_BTN_CONF[E.SHARETYPE_PRIVACY][E.PAGETYPE_MULTI] = [E.TYPE_SAVETODISK, E.TYPE_DOWNLOAD, E.TYPE_DIMESIONAL, E.TYPE_SHARETO, E.TYPE_REPORT], E.prototype.constructor = E, E.prototype.init = function () { var e; e = 1 === this.pageBtnConf.myself || 1 === yunData.MYSELF ? E.SELF_BTN_CONF[this.pageBtnConf.shareType][this.pageBtnConf.pageType] : E.OTHERS_BTN_CONF[this.pageBtnConf.shareType][this.pageBtnConf.pageType]; for (var t = 0, n = e.length; n > t; t++) this.build[e[t]].call(this); "1" === d.getItem("transferFiles") && (a("#emphasizeButton").click(), d.removeItem("transferFiles")) }, E.initPassAPI = function (e) { c.getWidgets("common:widget/passAPI/passAPI.js", e) }, E.initPassBindMobile = function () { E.initPassAPI(function (e) { e.promiseBindMobile.done(function () { e.passAPI.PassportBindMobile.netdiskBindMobile({ reload: !1 }), e.passAPI.PassBindMobileDialog.onBindSuccessCallback = function () { E.isNewUserAndNoMobile = 2, E.isNotLoginStatus && c.sendUserReport("web_dialog_login"), a("#emphasizeButton").click(), c.shareFileLog("operateBtnShareLogSucc"), c.shareFileLog("bindPassMobileSuccess") }, e.passAPI.PassBindMobileDialog.onBindFailCallback = function () { } }) }), c.shareFileLog("bindPassMobile") }, E.prototype.build = {}, E.prototype.build[E.TYPE_REPORT] = function () { var e = a('<a class="new-dbtn" id="tousu" hidefocus="true" href="http://tousu.baidu.com/pan/add" target="_blank"><b>举报</b></a>'); this.pageBtnConf.bigContainer.append(e) }, E.prototype.build[E.TYPE_CANCELSHARE] = function () { var e = this, t = a('<a class="new-dbtn" href="javascript:void(0);" hidefocus="true" id="cancelShareButton"><em class="global-icon-share-cancel"></em><b>取消分享</b></a>'); e.pageBtnConf.shareType === E.SHARETYPE_ALBUM ? t.find("new-dbtn").attr("href", e.pageBtnConf.info.dlink) : t.bind("click", function () { r.cancelShare({ share_id: yunData.SHARE_ID }, function () { try { window.opener = null, window.close() } catch (e) { } finally { window.location.reload() } }, function () { }) }), this.pageBtnConf.bigContainer.append(t) }, E.prototype.build[E.TYPE_SAVETODISK] = function () { var e = this, t = a('<a hidefocus="true" id="emphasizeButton" href="javascript:void(0);" class="new-sbtn okay"><em class="btn-icon icon-share-save"></em><b>保存至网盘</b></a>'); this.pageBtnConf.bigContainer.append(t), t.bind("click", function () { if (c.shareFileLog("operateBtnShareLog"), "1" !== yunData.LOGINSTATUS) return E.isNotLoginStatus = !0, E.initPassAPI(function (e) { e.promise.done(function () { e.passAPI.PassportInit.netdiskLogin({ reload: !0, flagSendReport: !1 }), e.passAPI.PassLoginDialog.onLoginSuccessCallback = function (t) { var n = t.rsp.data.userName; e.passAPI.PassportInit.hide(), n !== yunData.SHARE_USER_NAME && d.setItem("transferFiles", "1") } }) }), !1; var t = function () { var t, n = null; if (e.pageBtnConf.pageType === E.PAGETYPE_SINGLE) t = e.pageBtnConf.info; else if (e.pageBtnConf.pageType === E.PAGETYPE_MULTI) t = e.pageBtnConf.info; else { if (!Array.isArray(this.selectedFileList)) return e.dispatchEvent("NeedSelectedFileList"), void (disk.DEBUG && console.log("[WARN] cant save to disk because the selected filelist is not an array")); t = this.selectedFileList } e.pageBtnConf.shareType === E.SHARETYPE_ALBUM ? (n = yunData.ALBUMINFO, r.transferFiles(t, n, !1, function () { e.dispatchEvent("SaveToDiskSuccess") }, function () { e.dispatchEvent("SaveToDiskFailure") })) : e.pageBtnConf.pageType === E.PAGETYPE_SINGLE ? r.transferFiles({ isMulti: !1, fileObj: t, callback: function (e, t) { (0 == t.errno || 12 == t.errno && -30 == t.info[0].errno) && mdev.message.trigger("share-video-after-transfer") } }) : e.pageBtnConf.pageType === E.PAGETYPE_MULTI && mdev.message.trigger("shareOperateBtn:multi-save") }, n = function () { E.isNewUserAndNoMobile = 2, t() }; 0 === E.isNewUserAndNoMobile ? a.getJSON("/api/account/ubindinfo", function (e) { e && 0 == e.errno && 0 == e.has_mobil && 0 == e.type && e.token_bindmobile ? (E.isNewUserAndNoMobile = 1, yunData.tokenBindMobile = e.token_bindmobile) : n() }).error(function () { n() }) : 1 === E.isNewUserAndNoMobile || t() }) }, E.prototype.build[E.TYPE_SAVEANDPLAY] = function () { if (this.pageBtnConf.pageType !== E.PAGETYPE_SINGLE || 1 != yunData.FILEINFO[0].category) return void (disk.DEBUG && console.log("[WARN] this page is not a single file page or the single file is not a video file")); var e, t = this, n = a('<a hidefocus="true"  id="emphasizePlayButton" href="javascript:void(0);" class="new-sbtn okay"><em class="global-icon-videoplay-save"></em> <b>保存并播放</b> </a>'); this.pageBtnConf.bigContainer.append(n), this.pageBtnConf.pageType === E.PAGETYPE_SINGLE ? e = !1 : this.pageBtnConf.pageType === E.PAGETYPE_MULTI && (e = !0), n.bind("click", function () { var n = null; t.pageBtnConf.shareType === E.SHARETYPE_ALBUM ? (n = yunData.ALBUMINFO, r.transferFiles(yunData.FILEINFO, n, !0, function () { t.dispatchEvent("SaveToDiskSuccess") }, function () { t.dispatchEvent("SaveToDiskFailure") })) : r.transferFiles({ isMulti: e, fileObj: t.pageBtnConf.info, callback: function (e, t) { 0 == t.errno && i.obtain.useToast({ toastMode: i.obtain.MODE_SUCCESS, msg: '视频已保存到网盘<a href="http://pan.baidu.com/disk/home#dir/path=' + encodeURIComponent("/我的资源") + '">我的资源</a>, 可以在其他终端上继续观看哦', sticky: !0, position: s.TOP, closeType: !0 }) }, savepath: "/我的资源" }) }) }, E.prototype.build[E.TYPE_DOWNLOAD] = function () { var e, t = this; if (t.pageBtnConf.pageType === E.PAGETYPE_SINGLE) var e = a('<a class="new-dbtn" href="javascript:void(0);" hidefocus="true" id="downFileButton"><em class="global-icon-download"></em><b>下载(' + c.toFriendlyFileSize(yunData.FILEINFO[0].size) + ")</b></a>"); else if (t.pageBtnConf.pageType === E.PAGETYPE_MULTI) var e = a('<a class="new-dbtn" href="javascript:void(0);" hidefocus="true" id="downFileButton"><em class="global-icon-download"></em><b>下载</b></a>'); t.pageBtnConf.shareType === E.SHARETYPE_ALBUM ? e.find("new-dbtn").attr("href", t.pageBtnConf.info.dlink) : t.pageBtnConf.pageType === E.PAGETYPE_SINGLE ? e.bind("click", function () { c.getWidgets("common:widget/downloadProxyPcs/downloadProxyPcs.js", function () { mdev.message.trigger("download", { product: "share", share_id: yunData.SHARE_ID, share_uk: yunData.SHARE_UK, list: yunData.FILEINFO, sign: yunData.SIGN, timestamp: yunData.TIMESTAMP }) }), c.shareFileLog("shareview_downloadClick") }) : t.pageBtnConf.pageType === E.PAGETYPE_MULTI && e.bind("click", function () { mdev.message.trigger("shareOperateBtn:download"), c.shareFileLog("shareview_downloadClick") }), this.pageBtnConf.bigContainer.append(e) }, E.prototype.build[E.TYPE_DIMESIONAL] = function () { var e, t = this, n = a('<a id="shareqr" href="javascript:void(0);" hidefocus="true" class="new-dbtn wd2"><em class="btn-icon icon-share-qr"></em><b>二维码</b></a>'); this.pageBtnConf.bigContainer.append(n), n.bind("mouseover", function () { if (0 == a(".dialog_two_dimension_code").length) { var i = function () { var i, s; if (t.pageBtnConf.pageType === E.PAGETYPE_SINGLE) { var o = t.pageBtnConf.info[0].server_filename.split("."); i = o[o.length - 1], i = i.length > 10 ? "na" : i } else t.pageBtnConf.pageType === E.PAGETYPE_MULTI && (i = "multi"); s = location.href.indexOf("#") > 0 ? location.href.substring(0, location.href.indexOf("#")) : location.href; var r = "/share/qrcode?w=148&h=148&url=" + encodeURIComponent(s + "&qrfrom=1&qrtype=" + i), l = a("#shareqr").hasClass("down") ? "down" : "top", c = a("#shareqr").hasClass("down") ? -224 : 8, d = new e({ target: a("#shareqr"), imgSrc: r, imgTit: "", flagAddIframe: !0, imgDes: "扫描二维码，将文件发送到手机", topOffset: c, changetextdec: !0, panlclick: !0, arrowPos: l, showsource: "shareqr", hoverCallBack: function () { n.find("em").addClass("active") }, leaveCallBack: function () { n.find("em").removeClass("active") } }); d.setVisible(!0) }; "undefined" == typeof e ? c.getWidgets("common:widget/twoDimension/twoDimension.js", function (t) { e = t, i() }) : i() } }) }, E.prototype.build[E.TYPE_RECOMMEND] = function () { var e = a('<a class="funcs-tui" hidefocus="true" href="javascript:void(0);" id="albumTui" title="赞"> <em class="tui_icon"></em><b>赞(0)</b><span class="tui-number"></span></a>'); this.pageBtnConf.smallContainer.children().length && this.pageBtnConf.smallContainer.append('<span class="share-operate-seprate">|</span>'), this.pageBtnConf.smallContainer.append(e), e.bind("click", function () { "1" !== e.data("tuiing") && (e.data("tuiing", "1"), c.getWidgets("common:widget/tuiBtn/tuiBtn.js", function (t) { var n = { state: +e.data("tuiStatus"), sourceUk: yunData.SHARE_UK, type: 0, sourceId: yunData.SHARE_ID, ele: a("#albumTui") }; t.init(n, function (t) { if (t !== !1) { if (n.state) { E.recommendNumber += 1; var a = E.recommendNumber > 999 ? "999+" : E.recommendNumber; n.ele.find(".tui-number").show().text("+1").delay(300).fadeOut(300, function () { n.ele.attr({ title: "取消赞" }).html("<em></em><b>已赞(" + a + ')</b><span class="tui-number"></span>'), e.data("tuiing", "0") }) } else { E.recommendNumber -= 1; var a, i = E.recommendNumber; a = i > 999 ? "999+" : i, a = 0 > i ? 0 : i, n.ele.find(".tui-number").show().text("-1").delay(300).fadeOut(300, function () { n.ele.attr({ title: "赞" }).html('<em class="tui_icon"></em><b>赞(' + a + ')</b><span class="tui-number"></span>'), e.data("tuiing", "0") }) } e.data("tuiStatus", "1" === e.data("tuiStatus") ? "0" : "1") } else e.data("tuiing", "0") }) })) }), this.getLikeNumber(!0) }, E.prototype.build[E.TYPE_COMMENT] = function () { var e, t = this; this.pageBtnConf.smallContainer.children().length && this.pageBtnConf.smallContainer.append('<span class="share-operate-seprate">|</span>'), this.pageBtnConf.pageType !== E.PAGETYPE_SINGLE ? (e = a('<div class="comment-container"><a class="funcs-comment" href="javascript:void(0);">评论</a></div>'), e.find("a").bind("click", function (e) { e.stopPropagation(); var n = a(this); if (void 0 === t._mCommentPanel) { var i = { source_uk: yunData.SHARE_UK, source_id: yunData.SHARE_ID, type: 0, avatar_url: yunData.MYAVATAR, uname: yunData.MYNAME, current_uk: yunData.MYUK, domType: 2, limit: 20, dialog: { hasBorder: !0, hasArraw: !0, hasScroll: !0, left: 290 } }; c.getWidgets("common:widget/commentPanel/commentPanel.js", function (e) { t._mCommentPanel = new e, n.after("<div class='comment-share-panel'></div>"), t._mCommentPanel.startInit(n.next(".comment-share-panel"), i), t._mCommentPanel.getTotalCount = function (e) { var t = e > 999 ? "999+" : e; n.text("评论(" + t + ")") }, n.next(".comment-share-panel").bind("click", function (e) { e.stopPropagation() }), a(document).bind("click", function () { n.next(".comment-share-panel").hide() }) }) } else n.next(".comment-share-panel").toggle() })) : e = a('<a class="funcs-comment" href="#comment_panel">评论</a>'), this.pageBtnConf.smallContainer.append(e) }, E.prototype.build[E.TYPE_SHARETO] = function () { var e = a('<div class="funcs-share"><span>分享至</span><em class="btn-icon more-icon"></em><div id="bdshare_panel"><div id="bdshare" class="bdshare_t bds_tools get-codes-bdshare"><a class="bds_tsina">新浪微博</a><a class="bds_qzone">QQ空间</a><a class="bds_tqq">腾讯微博</a><a class="bds_renren">人人网</a><a class="bds_t163">网易微博</a></div><iframe src="about:blank" id="bdsshare_panel_iframe" frameborder="0"></iframe></div></div>'); this.pageBtnConf.smallContainer.children().length && this.pageBtnConf.smallContainer.append('<span class="share-operate-seprate">|</span>'), this.pageBtnConf.smallContainer.append(e), e.bind("mouseover", function () { a("#bdshare_panel").show() }).bind("mouseleave", function () { a("#bdshare_panel").hide() }); var t = "Hi，好东西一起分享，给大家分享“" + this.shareFileName + "”文件，快来看看吧~~来自#百度云#"; window.bds_config = { bdPopTitle: "百度云专辑", bdText: t, des: t, text: t, searchPic: 1, comment: t }; var n = document.createElement("script"); n.type = "text/javascript", n.id = "bdshare_js", n.setAttribute("data", "type=tools"), document.body.appendChild(n); var i = document.createElement("script"); i.type = "text/javascript", i.id = "bdshell_js", i.src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion" + Math.ceil(new Date / 36e5), document.body.appendChild(i) }, E.prototype.updateNumber = function (e) { var t = E.recommendNumber > 999 ? "999+" : E.recommendNumber; "comment" !== e && (E.recommendStatus ? (a("#albumTui", this.pageBtnConf.smallContainer).attr({ title: "取消赞" }).html("<em></em><b>已赞(" + t + ')</b><span class="tui-number"></span>'), a("#albumTui").data("tuiStatus", "0")) : (a("#albumTui b").html("赞(" + t + ")"), a("#albumTui").data("tuiStatus", "1"))), "recommend" !== e && E.commentNumber > 0 && a(".funcs-comment", this.pageBtnConf.smallContainer).text("评论(" + E.commentNumber + ")") }, E.prototype.getLikeNumber = function (e) { if (this.isAlreadyGetLike) return void (e && this.updateNumber()); var t = this; a.ajax({ type: "post", url: o.LIKE_GET, data: { type: 1, query_uk: yunData.SHARE_UK, source_id: yunData.SHARE_ID }, timeout: 1e5, success: function (e) { if (!t.isAlreadyGetLike) { var e = a.parseJSON(e); e && 0 == e.errno && (t.isAlreadyGetLike = !0, E.recommendNumber += e.like_count, E.commentNumber += e.comment_count, E.recommendStatus = e.like_status, t.updateNumber()) } } }) }, E.prototype.setSelectedFileList = function (e) { this.selectedFileList = Array.isArray(e) ? e : null }, n.exports = E });
; define("common:widget/toastPanel/toastPanel.js", function (e, i, t) { var s = e("common:widget/panel/panel.js"), n = e("common:widget/timerService/timerService.js"), o = e("common:widget/libs/jquerypacket.js"), r = function () { this._mMode = 0, this._mMsgHolderId = disk.obtainId(), this._mMsgHolder = null, s.call(this, this._prebuild()), this._mTimerService = null, this._pendTask = null }; r.MODE_LOADING = 1, r.MODE_CAUTION = 2, r.MODE_SUCCESS = 4, r.MODE_FAILURE = 8, r.DURATION_DISAPPEAR = 3e3, r.prototype = new s, r.prototype._prebuild = function () { var e = document.createElement("div"); return e.className = "b-panel b-dialog toast-dialog toast-content b-bdr-6 bdr-rnd-3 box-shadow", document.body.appendChild(e), e.innerHTML = '<div class="toast-outer"><div id="' + this._mMsgHolderId + '" class="toast-msg ellipsis"><em class="b-in-blk b-ic-dimen-1 loading"></em></div></div>', { pane: e } }, r.prototype.pending = function (e) { this._pendTask = e }, r.prototype.setVisible = function (e, i) { var t = this; this._mTimerService && this._mTimerService.isAlive() && this._mTimerService.interrupt(), e ? (this._mUI.pane.style.display = "block", this.setGravity(s.TOP), t._scheduleHiding(i)) : (t._mUI.pane.style.display = "none", null != t._pendTask && (t._pendTask.call(t), t._pendTask = null)) }, r.prototype.setPositionRB = function (e, i) { e = o(window).width() - this._mUI.pane.offsetWidth - Math.max(32, e), i = o(window).height() - this._mUI.pane.offsetHeight - Math.max(42, i), this._mUI.pane.style.left = e + "px", this._mUI.pane.style.top = i + "px" }, r.prototype._scheduleHiding = function (e) { var i = this; this._mTimerService || (this._mTimerService = new n(r.DURATION_DISAPPEAR, function () { i.setVisible(!1) })), "boolean" != typeof e || e ? "number" == typeof e && e > 0 && (this._mTimerService.setInterval(e), this._mTimerService.start()) : this._mTimerService.start() }, r.prototype.setMessage = function (e, i) { this._mMsgHolder || (this._mMsgHolder = document.getElementById(this._mMsgHolderId)); var t = null; switch (e) { case r.MODE_LOADING: t = "loading"; break; case r.MODE_CAUTION: t = "ic-mini-caution"; break; case r.MODE_SUCCESS: t = "ic-mini-ok"; break; case r.MODE_FAILURE: t = "ic-mini-failure" } if (null == t) throw new Error("not hit a toast type exception"); this._mMsgHolder.innerHTML = '<em class="sprite-ic b-in-blk b-ic-dimen-1 ' + t + '"></em>' + i + '<em class="close-tips"> </em>' }, r.prototype.setClose = function (e) { var i = this, t = o("#" + this._mMsgHolderId).children(".close-tips"); e ? t.show() : t.hide(), t.click(function () { i.setVisible(!1) }) }, t.exports = r }); define("common:widget/docReader/docReader.js", function (e, t, o) { var i = e("common:widget/libs/jquerypacket.js"), a = e("common:widget/commonService/commonService.js"), n = e("common:widget/context/context.js"), r = e("common:widget/toast/toast.js"), c = (e("common:widget/timerService/timerService.js"), e("common:widget/restApi/restApi.js")), d = e("common:widget/panel/panel.js"), s = function () { this._mTitleId = disk.obtainId(), this._mIconId = disk.obtainId(), this._mCloseId = disk.obtainId(), d.call(this, this._prebuild(this._mTitleId, this._mIconId, this._mCloseId)), this.build(), this.count = 0, s._current = this }; s._docData = {}, s._current = null, s._currentKey = null, s.clearDocData = function (e) { s._docData[e] = null, delete s._docData[e] }, s.clearAllDocData = function () { s._docData = [] }, s.docData = function (e, t) { return "undefined" == typeof e ? s._docData[t] : void (s._docData[t] = e) }, s.docURLData = function (e, t) { return "undefined" == typeof e ? s._docData[t] && s._docData[t].urls : (s._docData[t] = s._docData[t] || {}, void (s._docData[t].urls = e)) }, s.docPageWarm = function (e) { if (e) { i(".pageWarm").remove(); var t = "<div class='pageWarm'><em class='tit-img'></em>文档目前只能预览100页，该文档超出了100页，请下载查看全部内容"; i(".doc-dialog .dlg-hd,.slide-show-header").append(t) } else i(".pageWarm").remove() }, s.isMathon = function () { return "undefined" != typeof window.external && "undefined" != typeof window.external.max_version ? function () { return "?" + Math.random() } : function () { return "" } }(), s.sendLog = function (e, t) { a.diskLog.send({ type: "docpreview", success: t, size: e.size, time: e.time, count: e.count, filetype: e.type, pagenumber: e.page, t: (new Date).getTime() }) }, s.sendPreviewLog = function (e, t, o) { a.diskLog.send({ type: "docpreview-successed-analyties", ctime: t.server_ctime, fsid: t.fs_id, md5: t.md5, successed: e, docerrorcode: o || -1 }) }, s.createswf = function (e, t) { var o, i, a, n, e = e || {}; tmpOpt = {}; for (i in e) tmpOpt[i] = e[i]; e = tmpOpt; var r = e.vars, c = ["classid", "codebase", "id", "width", "height", "align"]; if (e.align = e.align || "middle", e.classid = "clsid:d27cdb6e-ae6d-11cf-96b8-444553540000", e.codebase = "http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0", e.url ? e.movie = e.url || "" : e.flashType && (e.movie = "/yun-static/common/thirdparty/wenku/" + e.flashType), delete e.vars, delete e.url, "string" == typeof r) e.flashvars = r; else { var d = []; for (i in r) n = r[i], d.push(i + "=" + encodeURIComponent(n)); e.flashvars = d.join("&") } var s = ["<object "]; for (o = 0, a = c.length; a > o; o++) n = c[o], s.push(" ", n, '="', e[n], '"'); s.push(">"); var l = { wmode: 1, scale: 1, quality: 1, play: 1, loop: 1, menu: 1, salign: 1, bgcolor: 1, base: 1, allowscriptaccess: 1, allownetworking: 1, allowfullscreen: 1, seamlesstabbing: 1, devicefont: 1, swliveconnect: 1, flashvars: 1, movie: 1 }; for (i in e) n = e[i], i = i.toLowerCase(), l[i] && (n || n === !1 || 0 === n) && s.push('<param name="' + i + '" value="' + n + '" />'); e.src = e.movie, e.name = e.id, delete e.id, delete e.movie, delete e.classid, delete e.codebase, e.type = "application/x-shockwave-flash", e.pluginspage = "http://www.macromedia.com/go/getflashplayer", s.push("<embed"); var u; for (i in e) if (n = e[i], n || n === !1 || 0 === n) { if (new RegExp("^salign$", "i").test(i)) { u = n; continue } s.push(" ", i, '="', n, '"') } u && s.push(' salign="', u, '"'), s.push("></embed></object>"), t && "string" == typeof t && (t = document.getElementById(t)), t.innerHTML = s.join("") }, s.prototype = new d, s.getFlash = function () { return function e(t, o, i) { var a = document[t]; return a && a.length > 1 && (a = a[1]), a && a[o] ? (s._mFlash = a, void i()) : (setTimeout(function () { e(t, o, i) }, 50), !1) } }(), s.prototype._prebuild = function (e, t, o) { var i = document.createElement("div"); return i.className = "b-panel doc-dialog", document.body.appendChild(i), i.innerHTML = ['<div class="dlg-hd b-rlv"><span title="关闭" id="', o, '" class="dlg-cnr dlg-cnr-r"></span><h3 id="', e, '">文档阅读器</h3></div>', '<div class="dlg-bd"></div>'].join(""), { pane: i } }, s.prototype.setVisible = function (e) { d.prototype.setVisible.call(this, e), e && this.setGravity(d.CENTER) }, s.prototype.onVisibilityChange = function (e) { var t = n.getService(n.SERVICE_CANVAS); t.setVisible(e) }, s.prototype.build = function () { var e = this; i(window).bind("resize", function () { e.setGravity(d.CENTER) }), i("#" + this._mCloseId, this._mUI.pane).click(function () { e.clearReader() }) }, s.prototype.reBuildFn = function (e, t) { var o = this, d = { id: "chunleireader", loop: !0, allowfullscreen: !0, width: "100%", height: "100%", wmode: "window", ver: "10.0", errorMessage: "请下载最新的Flash播放器！", bgcolor: "#FFFFFF", allowscriptaccess: "always" }; t.pages >= 100 ? s.docPageWarm(!0, t) : s.docPageWarm(!1), r.obtain.useToast({ toastMode: r.obtain.MODE_LOADING, msg: "正在加载文档……", sticky: !0 }); var l = t.type, u = t.pages, p = t.docpreview || c.DOCPREVIEW + "&path=" + encodeURIComponent(t.path); p = p + "&method=view&md5=" + t.md5; var e = "", m = "txt", g = "browser", f = "0|0", h = "/yun-static/common/thirdparty/wenku/"; h += "txt" == l.toLocaleLowerCase() ? "commtxtreader.swf" : "commreader.swf", h += s.isMathon(), d.url = h, d.vars = { totalpages: u, docurl: p, docid: e, ext: m, pid: g, bookmark: f }, "undefined" == typeof cwkreader && (cwkreader = {}, cwkreader.loadSucceed = function (e) { r.obtain.setVisible(!1), s.sendLog(e, 1), 0 == s._current.flagSendLog && (s._current.flagSendLog = !0, s.sendPreviewLog(1, s._current.cacheFileObj)) }, cwkreader.loadFail = function (e) { s.sendLog(e, 0), 0 == s._current.flagSendLog && (s._current.flagSendLog = !0, e = e || {}, s.sendPreviewLog(0, DocReader._current.cacheFileObj, e.error_code)) }), o.setVisible(!0), s.createswf(d, i(".doc-dialog .dlg-bd")[0]), n.getService(n.SERVICE_TOAST).setVisible(!1), s.getFlash("chunleireader", "doMouseWheel", function () { a.mouseWheel(i(".doc-dialog .dlg-bd")[0].childNodes[0], function (e) { s._mFlash.doMouseWheel(e) }, 12) }) }, s.config = null, s.prototype.reBuild = function (e, t) { var o = this, a = e.path, n = "", d = "", l = e.md5, u = e.server_filename; a = a.slice(a.indexOf("/")), d = u.slice(u.lastIndexOf(".")), s._current.cacheFileObj = e, s._current.flagSendLog = !1, s.config = t || null; var p = { method: "info", md5: l, type: "txt" == d.slice(1).toLocaleLowerCase() ? "txt" : "swf", callback: "docReader.pcsCallback" }; if (n = s.docData(void 0, l), n || (s.docData({}, l), n = s.docData(void 0, l)), !e.docpreview) { if (!e.docpreview_sign) return void r.obtain.useToast({ toastMode: r.obtain.MODE_CAUTION, msg: "无法初始化阅读器，请刷新后再试", sticky: !1 }); e.docpreview = e.docpreview_sign } e.docpreview || (p.path = a), n.fs_id = e.fs_id, n.docpreview = e.docpreview, n.dlink = e.dlink, n.size = e.size, n.path = p.path, n.type = p.type, n.md5 = p.md5, n.path = e.path, n.server_filename = e.server_filename, s._currentKey = l; var m = function () { n.pages ? o.reBuildFn(l, n, "pcs") : i.ajax({ url: n.docpreview || c.DOCPREVIEW, type: "GET", data: p, timeout: 2e3, global: !0, cache: !1, dataType: "script" }).success(function () { }).error(function () { r.obtain.useToast({ toastMode: r.obtain.MODE_CAUTION, msg: "无法初始化阅读器，请稍候再试", sticky: !1 }) }) }; i("#" + this._mTitleId).text(u), r.obtain.useToast({ toastMode: r.obtain.MODE_LOADING, msg: "正在加载数据&hellip;", sticky: !0 }), m() }, s.prototype.clearReader = function () { i(".doc-dialog .dlg-bd").html(""), this.setVisible(!1) }, s.pcsCallback = function (e, t) { var t = t || s._currentKey, o = s._docData[t] = s._docData[t] || {}; for (var i in e) o[i] = e[i]; o.pages && s._current.count > 0 && a.diskLog.send({ url: "http://pan.baidu.com/api/analytics", type: "docpreview-recall-successed" }), o.pages ? s._current.reBuildFn(this._currentKey, o, "pcs") : 31162 == o.error_code ? (r.obtain.useToast({ toastMode: r.obtain.MODE_LOADING, msg: "正在加载数据&hellip;", sticky: !1 }), a.diskLog.send({ type: "docpreview-error", error: o.error_code }), s._current.clearReader(), "txt" == o.type && s._current.count < 2 ? (setTimeout(function () { s._current.reBuild(s._current.cacheFileObj) }, 2e3), s._current.count++) : (s._current.count = 0, r.obtain.useToast({ toastMode: r.obtain.MODE_CAUTION, msg: "文件正在转码，请稍候再试", sticky: !1 }), 0 == s._current.flagSendLog && (s._current.flagSendLog = !0, s.sendPreviewLog(0, s._current.cacheFileObj, o.error_code)))) : 31161 == o.error_code && (r.obtain.useToast({ toastMode: r.obtain.MODE_CAUTION, msg: "文档正在转码，请稍候再试", sticky: !1 }), 0 == s._current.flagSendLog && (s._current.flagSendLog = !0, s.sendPreviewLog(0, s._current.cacheFileObj, o.error_code))) }, window.docReader = s, o.exports = s }); define("common:widget/videoFlash/videoFlash.js", function (t, e, o) {
    var i = t("common:widget/libs/jquerypacket.js"), n = t("common:widget/panel/panel.js"), a = t("common:widget/commonService/commonService.js"), s = t("common:widget/context/context.js"), r = t("common:widget/restApi/restApi.js"), p = function () { this._init() }; p.target = null, p.flashPlayer = null, p.singleton = null, p.FLASH_BPS = -1 != navigator.platform.indexOf("iPhone") || -1 != navigator.platform.indexOf("iPad") ? ["M3U8_AUTO_480"] : ["M3U8_FLV_264_480"], p.SUPPORT_EXTS = "3gpp m3u8 m3u asf wmv avi flv f4v mkv mov mp4 m4a m4v 3gp 3g2 mj2 mp2 m2a mp3 mpeg mpg ts ogg MTS M2TS dat wma aac m4a ape flac rm rmvb wav webm".split(/\s+/), p.opts = null, p.obtain = function () { return null == p.singleton && (p.singleton = new p), p.singleton }, p.prototype._init = function () { }, p.prototype.play = function (t) {
        if (p.opts = t, p.target = "string" == typeof t.target ? i("#" + t.target) : t.target, this.checkSupport())

            if (this.checkSupportExt(t.path)) {
                this.destory();
                var e = this.getVideoPath(t),
                o = i('<div style="height:100%" id="video-wrap-inner"></div>');
            o.appendTo(p.target);
            var n = {
                containerId: o.attr("id"),
                src: "/yun-static/common/thirdparty/flashVideo/player/DiskPlayer.swf?t=1448771723343",
                file: e
            };
            t.autoStart === !1 && (n.autoStart = "false"),
            t.srturl && (n.srturl = t.srturl),
            p.flashPlayer = diskPlayer(n),
            this.installFlasyEvent(t)
        } else
            this.installNotSupportExtDom(p.target); else this.installNotSupportDom(p.target)
    }, p.prototype.checkSupport = function () { var t = this.getFlashVersion(); return null == t || parseFloat(t, 10) < 10.1 ? !1 : !0 }, p.prototype.checkSupportExt = function (t) { for (var e = t.substr(t.lastIndexOf(".") + 1).toLowerCase(), o = p.SUPPORT_EXTS, i = 0, n = o.length; n > i; ++i) if (o[i] == e) return !0; return !1 }, p.prototype.installNotSupportDom = function (t) { if (i('<div class="flash-video-notsupport-tips"><div class="cover-img"><img/></div><p>安装Flash插件后就可以看视频啦，快来下载安装吧</p><p>（安装成功后，重启浏览器就可以播放啦）</p><p><a class="downloadbtn" target="_blank" href="http://get.adobe.com/cn/flashplayer/">下载Flash插件</a></p></div>').appendTo(t), p.opts.cover_img) { var e = i(".flash-video-notsupport-tips").find(".cover-img img"); e.bind("load", function () { i(".flash-video-notsupport-tips").css("background", "#262626") }), e.bind("error", function () { i(this).remove(), i(".flash-video-notsupport-tips").css({ paddingTop: 180, paddingBottom: 220 }) }), e.attr("src", p.opts.cover_img) } else i(".flash-video-notsupport-tips").css({ paddingTop: 180, paddingBottom: 220 }) }, p.prototype.installNotSupportExtDom = function (t) { i('<div class="flash-video-notsupport-ext-tips"><p>暂不支持播放此格式的视频</p></div>').appendTo(t) }, p.prototype.onplayererrorFunc = function (t) { this.destory(), i("#video-wrap-inner").remove(), i('<div class="flash-video-notsupport-ext-tips"><p>' + t + "</p></div>").appendTo(p.target) }, p.prototype.getFlashVersion = function () { return a.getFlashVersion() }, p.prototype.getVideoPath = function (t) { var e = p.FLASH_BPS[t.bps || 0], o = "", i = "&path=" + encodeURIComponent(t.path) + "&type=" + e + "&app_id=250528"; return o = 1 == t.type ? r.SHARE_STREAM_FILE + "?" + r.VENDOR_INFO + i + "&uk=" + t.uk + "&sign=" + t.sign + "&timestamp=" + t.timestamp + "&shareid=" + t.shareid + "&albumid=" + t.albumid + "&fid=" + t.fid : r.PCS_FILE + "?method=streaming&" + i, disk.DEBUG && console.log(t.path, "___", o), o }, p.prototype.getTotalTime = function () { if (p.flashPlayer) { var t = "function" == typeof p.flashPlayer.getDuration ? p.flashPlayer.getDuration() : 0, e = "function" == typeof p.flashPlayer.getFullDuration ? p.flashPlayer.getFullDuration() : 0, o = Math.max(parseInt(t, 10) || 0, parseInt(e, 10) || 0) || 0; return o >= 0 ? o : 0 } return 0 }, p.prototype.getPosition = function () { var t = 0; return p.flashPlayer && (t = p.flashPlayer.getPosition()), t }, p.prototype.installFlasyEvent = function (t) { var e = p.flashPlayer, o = this; if (e) { var i = 0; e.onTime(function (e) { t.md5 && (i++, i > 50 && (p.setStorageItem(t.md5, o.getPosition()), i = 0)), "function" == typeof t.onTime && t.onTime(e) }), "function" == typeof t.onReady && e.onReady(function () { t.onReady() }), "function" == typeof t.onSeek && e.onSeek(function (e, o) { t.onSeek(e, o) }), "function" == typeof t.onPlay && e.onPlay(function () { t.onPlay() }), "function" == typeof t.onLoad && e.onLoad(function () { t.onLoad() }), "function" == typeof t.onPause && e.onPause(function () { t.onPause() }), "function" == typeof t.onBeforePlay && e.onBeforePlay(function () { return t.onBeforePlay() }), "function" == typeof t.onBeforeSeek && e.onBeforeSeek(function (e) { return t.onBeforeSeek(e) }), e.onError(function (e) { disk.DEBUG && console.error("flashPlayer onError fired"), (!e.analytics || e.httpstatus) && (e.httpstatus && 404 == e.httpstatus && (e.error_code = 31066), "function" == typeof t.onError && t.onError(e.error_code)) }) } }, p.prototype.setDisplayState = function (t) { p.flashPlayer.setDisplayState(t) }, p.prototype.getDisplayState = function () { return p.flashPlayer.getDisplayState() }, p.FLAG_ADD_VIDEO_POSITION = !0, p.setStorageItem = function (t, e) { s.requestFeature(s.FEATURE_STORAGE, { succ: function () { p.FLAG_ADD_VIDEO_POSITION ? (localStorage.setItem("videoflash_" + t, e), disk.DEBUG && console.warn("add video flash position: ", t, "-", e)) : (localStorage.removeItem("videoflash_" + t), disk.DEBUG && console.warn("remove video flash position: ", t)) } }) }, p.getStorageItem = function (t, e) { s.requestFeature(s.FEATURE_STORAGE, { succ: function () { if ("function" == typeof e) { if (!t) return void e(0); var o = localStorage.getItem("videoflash_" + t); o && (o = parseInt(o, 10), o = 0 > o ? 0 : o), 0 / 0 == o && (o = 0), disk.DEBUG && console.warn(t, "-", o), e(o) } } }) }, p.sendLog = function (t, e) { e = e || {}, e.type = t, a.diskLog.send(e) }, p.prototype.destory = function () { p.flashPlayer && (p.flashPlayer.destroy(), p.flashPlayer = null) }, p.installFlashPlugin = function (t, e) { i.getScript("/yun-static/common/thirdparty/flashVideo/js/cyberplayer.min.js?t=1448771723343", function () { "function" == typeof t && t.call(null) }).error(function () { e.call(null) }) }; var l = function (t) { this.targetId = disk.obtainId(), this.iframeId = disk.obtainId(), this.config = t, n.call(this, this._prebuild()), this.bindEvent() }; l.prototype = new n, l.prototype._prebuild = function () { var t = document.createElement("div"); t.className = "b-panel b-dialog flash-video-tips"; var e = ['<div class="video-tips-inner ' + (this.config.className || "") + '">', '<span class="video-msg">' + this.config.text + "</span>", this.config.close ? '<span><em class="video-closebtn" title="关闭">关闭</em></span>' : "", "</div>"]; return t.innerHTML = e.join(""), document.body.appendChild(t), this.target = i(t), { pane: t } }, l.prototype.bindEvent = function () { var t = this; this.target.find(".video-closebtn").click(function () { t.setVisible(!1), "function" == typeof t.config.closeFunc && t.config.closeFunc() }); var e = this.config.userEvent; if ("undefined" != typeof e) for (var o in e) e.hasOwnProperty(o) && this.target.find(o).click(function () { e[o]() }) }, l.prototype.makeDivIframe = function () { this.targetIframe = i('<div class="flash-video-iframe-tips" id="video-iframe-' + this.iframeId + '" name="video-iframe-' + this.iframeId + '"></div>'), this.targetIframe.appendTo(document.body), this.targetIframe.css("background", "#000") }, l.prototype.onVisibilityChange = function (t) { if (t) { var e = this.config.iWidth || this.target.width(), o = this.config.iHeight || this.target.height(), i = this.config.iLeft || this.getLocation()[0], n = this.config.iTop || this.getLocation()[1]; this.makeDivIframe(), this.targetIframe.css({ left: i, top: n, width: e, height: o }), this.config.center && this.setLocation(i + (e / 2 - this.target.width() / 2), n + (o / 2 - this.target.height() / 2)) } else this.target.remove(), this.targetIframe.remove() }, l.removeAllTips = function () { i(".flash-video-tips").remove(), i(".flash-video-iframe-tips").remove() }, o.exports = { VideoFlash: p, VideoFlashTips: l }
});